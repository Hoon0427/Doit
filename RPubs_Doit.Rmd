---
title: "한국인의 삶을 파악하라!"
author: "HooN"
date: "`r Sys.Date()`"
output: 
  html_document:
    highlight: textmate
    theme: default
    toc: true
    toc_float: true
    code_folding: show
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 1.

## '한국복지패널데이터' 분석 준비하기

<br>

#### 한국복지패널데이터는 한국보건사회연구원에서 가구의 경제활동을 연구해 정책 지원에 반영할 목적으로 발간하는 조사 자료입니다. 전국에서 7000여 가구를 선정해 2006년부터 매년 추적 조사한 자료로, 경제활동, 생활실태, 복지욕구 등 천여 개 변수로 구성되어 있습니다. 다양한 분야의 연구자와 정책전문가들이 복지패널데이터를 활용해 논문과 연구보고서를 발표하고있습니다. 복지패널데이터는 엄밀한 절차로 수집되었고, 다양한 변수를 담고 있기 때문에 데이터 분석을 연습하는 데 훌륭한 재료입니다. 데이터는 다양한 삶의 모습이 담겨 있습니다. 한국복지패널데이터를 분석하면 대한민국 사람들이 어떻게 살아가고 있는지 알 수 있습니다.

<br>

### 1) 깃허브(bit.ly/doit_rb)에서 Koweps_hpc10_2015_beta1.sav 파일을 다운로드해 프로젝트 폴더에 삽입합니다. 이 파일은 2016년에 발간된 복지패널데이터로, 6,914가구, 16,664명에 대한 정보를 담고있습니다.

<br>

### 2) 패키지 설치 및 로드하기

#### 실습에 사용할 복지패널데이터는 통계분석 소프트웨어인 SPSS 전용 파일로 되어있습니다. foreign 패키지를 사용하면 SPSS, SAS, STATA 등 다양한 통계분석 소프트웨어의 파일을 불러올 수 있습니다.


```{r message=FALSE}
#install.packages("foreign")

library(foreign)
library(dplyr)
library(ggplot2)
library(readxl)
```

### 3) 데이터 불러오기

<br>

#### foreign 패키지의 read.spss()를 이용해 복지패널데이터를 불러옵니다. 원본은 복구해야 할 상황에 대비해 그대로 두고 복사본을 만들어 분석에 활용하겠습니다.

```{r message = FALSE}
# 데이터 불러오기
raw_welfare <- read.spss(file = "Koweps_hpc10_2015_beta1.sav",
                         to.data.frame = T)

# 복사본 만들기
welfare <- raw_welfare
```

### 4) 데이터 검토하기

<br>

#### 데이터를 불러왔으니 데이터의 구조와 특징을 파악해 보겠습니다.

```{r message=FALSE, warning=FALSE, eval=F}
head(welfare)
tail(welfare)
View(welfare)
dim(welfare)
str(welfare)
summary(welfare)
...
(출력 결과 생략)
```

<br>

#### 앞 장에서 예제로 사용했던 데이터들은 변수의 수가 적고 변수명이 이해할 수 있는 단어로 되어 있기 때문에 데이터 구조를 쉽게 파악할 수 있었습니다. 반면 복지패널데이터와 같은 대규모 데이터는 변수의 수가 많고 변수명이 코드로 되어 있는 경우가 많기 때문에 전체 구조를 한눈에 파악하기 어렵습니다. 이런 경우 데이터 전체를 한 번에 파악하기보다 변수명을 쉬운 단어로 바꾼 후 분석에 사용할 변수들을 각각 파악해야 합니다.

<br>

### 5) 변수명 바꾸기

<br>

#### 분석에 사용할 몇 개의 변수를 이해하기 쉬운 변수명으로 바꾸겠습니다. 규모가 큰 조사자료는 보통 데이터의 특성을 설명해 놓은 코드북(Codebook)과 함께 제공됩니다. 코드북에는 코드로 된 각각의 변수명이 무엇을 의마하는지 나타나 있습니다. 코드북을 보면 데이터의 특성에 대해 감을 잡을 수 있고, 분석에 어떤 변수를 활용할 것인지, 분석 방향에 대한 아이디어를 얻을 수 있습니다. <br> 한국복지패널 사이트에서 제공하는 코드북에서 실습에 사용할 변수의 일부를 선정해 깃허브에 공유해 두었습니다(Koweps_Codebook.xlsx). 다운로드해서 변수의 특성을 파악할 때 참고하세요. <br> 먼저, 분석에 사용할 7개 변수의 이름을 쉬운 단어로 바꾸겠습니다.

```{r}
 welfare <- rename(welfare,                  
                   sex = h10_g3,              # 성별
                   birth = h10_g4,            # 태어난 연도
                   marriage = h10_g10,        # 혼인 상태
                   religion = h10_g11,        # 종교
                   income = p1002_8aq1,       # 월급
                   code_job = h10_eco9,       # 직업 코드
                   code_region = h10_reg7)    # 지역 코드
```

### 데이터 분석 절차

<br>

#### 분석을 하는 데 필요한 준비가 끝났습니다. 이제 앞에서 선정한 변수들을 이용해 분석을 하겠습니다. 9장은 여러 가지 분석 주제를 다루고 있습니다. 각 분석은 두 단계 절차로 진행합니다.

### 1단계 : 변수 검토 및 전처리
#### 가장 먼저 분석에 사용할 변수들을 전처리합니다. 변수의 특성을 파악하고 이상치를 정제한 다음 파생변수를 만듭니다. 전처리는 분석에 활용할 변수 각각에 대해 실시합니다. 예를 들어 '성별에 따른 월급 차이'를 분석한다면 성별, 월급 두 변수를 각각 전처리합니다.

### 2단계 : 변수 간 관계 분석
#### 전처리가 완료되면 본격적으로 변수 간 관계를 파악하는 분석을 합니다. 데이터를 요약한 표를 만든 후 분석 결과를 쉽게 이해할 수 있는 그래프를 만듭니다.

<br>
<br>
<br>


# 2.

## "성별에 따라 월급이 다를까?"

<br>

#### 과거에 비해 여성들이 활발하게 사회 진출을 한다고는 하지만 직장에서 받는 대우에는 여전히 차별이 존재합니다. 데이터 분석을 통해 성별에 따라 월급 차이가 있는지 알아보겠습니다. <br> 먼저 성별과 월급 두 변수를 검토하고 전처리한 뒤 변수 간의 관계를 분석하겠습니다. 분석 절차를 요약하면 아래와 같습니다.

<br>

### 1단계 : 변수 검토 및 전처리
#### 성별
#### 월급

<br> 

### 2단계 : 변수 간 관계 분석
#### 성별 월급 평균표 만들기
#### 그래프 만들기

### 1)변수 검토하기
#### class()로 sex 변수의 타입을 파악하고, table()로 각 범주에 몇 명이 있는지 알아보겠습니다. 출력 결과를 보면 sex는 numeric 타입이고 1과 2로 구성됩니다. 1은 7578명, 2는 9086명이 존재합니다.

```{r}
class(welfare$sex)
table(welfare$sex)
```

### 2)전처리
#### 코드북을 보면 성별 변수의 값이 1이면 남자, 2면 여자를 의미한다는 것을 알 수 있습니다. 모른다고 답하거나 응답하지 않았을 경우에는 9로 코딩되어 있습니다. <br> 이 정보를 바탕으로 데이터에 이상치가 있는지 검토하고, 분석에서 이상치를 제외할 수 있도록 NA를 부여합니다. 값이 9일 경우도 성별을 알 수 없어 분석에서 제외해야 하므로 결측 처리합니다.

<br>

#### 위 table()에서 볼 수 있듯이, 1과 2만 있고 9 또는 그 외의 값은 존재하지 않습니다. 이상치가 없기 때문에 이상치를 결측 처리하는 절차를 건너뛰어도 됩니다. 만약 이상치가 발견된다면 아래와 같이 이상치를 결측 처리한 후 결측치가 제대로 만들어졌는지 확인하는절차를 거쳐야 합니다.

```{r}
# 이상치 결측 처리
welfare$sex <- ifelse(welfare$sex == 9, NA, welfare$sex)


# 결측치 확인
table(is.na(welfare$sex))
```

<br>

#### sex 변수의 값은 숫자 1과 2로 되어 있습니다. 값의 의미를 이해하기 쉽도록 문자 "male"과 "female"로 바꾸고, table(), qplot()을 이용해 바꾼 값이 반영됐는지 출력 결과를 확인합니다.

```{r}
# 성별 항목 이름 부여
welfare$sex <- ifelse(welfare$sex == 1, "male", "female")
table(welfare$sex)
qplot(welfare$sex)
```

<br>

#### 성별 변수의 전처리 작업이 완료됐습니다. 이제 동일한 절차로 월급 변수의 전처리 작업을 하겠습니다.

<br>

#### 1.변수 검토하기
#### 코드북을 보면 월급은 '일한 달의 월 평균 임금'을 의미하며 1만 원 단위로 기록되어 있습니다. income 변수를 검토하고 qplot()으로 분포를 확인하겠습니다. <br> 성별 변수는 범주 변수이기 때문에 table()로 각 범주의 빈도를 확인하면 특징을 파악할 수 있습니다. 하지만 월급 변수는 연속 변수이기 때문에 table()을 이용하면 너무 많은 항목이 출력됩니다. 연속 변수는 summary()로 요약 통계량을 확인해야 특징을 파악할 수 있습니다.

```{r}
class(welfare$income)
summary(welfare$income)
qplot(welfare$income)
```

<br>

#### income은 numeric 타입이고, 0~2400만 원 사이의 값을 지니며, 122~316 만 원 사이에 가장 많이 분포하고 있습니다. 평균은 241.6 만 원, 중앙ㄱ밧은 평균보다 작은 192.5만 원으로, 전반적으로 낮은 값 쪽으로 치우쳐 있습니다. <br> qplot()은 최댓값까지 표현하도록 기본값이 설정되어 있습니다. 출력된 그래프를 보면 x축이 2500까지 있어서 대다수를 차지하는 0~1000 사이의 데이터가 잘 표현되지 않습니다. xlim()을 이용해 0~1000까지만 표현되게 설정하겠습니다.

```{r}
qplot(welfare$income) + xlim(0,1000)
```

<br>

#### 출력된 그래프를 보면 월급의 분포가 좀 더 잘 드러납니다. 0~250만 원 사이에 가장 많은 사람이 분포하고 그 뒤로는 점차 빈도가 감소한다는 것을 알 수 있습니다.

<br>

#### 2.전처리
#### 코드북을 보면 월급은 1~9998 사이의 값을 지니며, 모름 또는 무응답은 9999로 코딩되어 있다는 것을 알 수 있습니다. 이 정보를 바탕으로 전처리 작업을 하겠습니다.

```{r}
summary(welfare$income)
```

<br>

#### 출력 결과를 보면 최솟값이 0, 최댓값이 2400이고, 결측치가 12030개 있습니다. 직업이 없어서 월급을 받지 않는 응답자가 있기 때문에 결측치가 존재하는 것입니다. 따라서 월급 변수를 이용하는 분석을 할 경우 먼저 결측치를 제외해야 합니다. <br> 코드북에는 월급이 1~9998 사이의 값을 지닌다고 되어 있는데 summary() 출력 결과에 최솟값이 0으로 나타나 있습니다. 이는 이상치가 존재한다는 것을 의미하므로, 값이 0이면 결측 처리해야 합니다. 값이 0이거나 9999일 경우 결측 처리하겠습니다. 그 후 다음 단계에서 성별과 월급의 고나계를 분설할 때 결측치를 제외하고 분석하겠습니다.

```{r}
#이상치 결측 처리
welfare$income <- ifelse(welfare$income %in% c(0,9999), NA, welfare$income)
#결측치 확인
table(is.na(welfare$income))
```




